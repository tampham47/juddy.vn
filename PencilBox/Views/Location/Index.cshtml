@model IEnumerable<PbData.Entities.pb_Location>

@{
    ViewBag.Title = "Địa điểm";
    //Layout = "~/Views/Shared/_UserLayout.cshtml";
    Layout = null;
}

<div>
    <div style="float:right; display:inline-block">
        <a href="~/Location/New" >
            <img src="~/Content/images/base-add-light.png" width="30" style="margin-top:7px"
                onmouseover="this.src='/Content/images/base-add-dark.png'"
                onmouseout="this.src='/Content/images/base-add-light.png'" /></a>
    </div>

    <hgroup class="title">
        <h1>@ViewBag.Title.</h1>
        <h2>@ViewBag.Message</h2>
    </hgroup>
</div>

<div class="Element">
    <div class="ImportantElement"></div>
    <div id="map_canvas" style="width:100%; height:300px"></div>
</div>

<table>
@foreach (var item in Model)
{
<tr>
    <td style="width:30px; padding-left:0px">
        <img src="~/Content/images/map-c.png" width="30px"/>
    </td>
    
    <td>
        <b style="color:#2d2d29">@item.Address</b>
    </td>
    
    <td style="width:90px; padding-right:0px">
        <a href="/Location/Edit?locationId=@item.LocationId" class="LightMetroButton" style="padding:8px 0px">
            Edit</a></td>

    <td style="width:70px; padding-right:0px">
        <a href="/Location/Delete?locationId=@item.LocationId" class="LightMetroButton" style="padding:8px 0px">
            Delete
        </a>
    </td>

    @*<td style="width:120px">
        <a href="/Location/SetCurrentLocation?locationId=@item.LocationId" class="GMetro-SmallButton">Current Location</a>
    </td>*@
</tr>
}
</table>

@*pull data to pos*@
<script>
    var pos = [];
</script>

@foreach (var item in Model)
{
    <script type="text/javascript">
        pos.push(['@item.Latitude', '@item.Longitude', '@item.Address']);
    </script>
}

@*@section scripts
{*@
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="../../Scripts/pb_MapExtend.js" type="text/javascript"></script>

    <script type="text/javascript">

        var addMarker = function (lat, lon, content) {
            var myLocation = new google.maps.LatLng(lat, lon);

            //bonus
            var marker = new google.maps.Marker({
                position: myLocation,
                draggable: false,
                animation: google.maps.Animation.DROP,
                title: "Select your place"
            });
            marker.setMap(map);

            google.maps.event.addListener(marker, 'click', function () {
                var infowindow = new google.maps.InfoWindow({
                    content: content
                });
                infowindow.open(map, marker);
            });
        }

        $(document).ready(function () {

            myOptions = {
                zoom: 7,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);

            // Try HTML5 geolocation
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {

                    var centerLocation = new google.maps.LatLng(pos[0][0], pos[0][1]);
                    map.setCenter(centerLocation);
                    for (var i = 0; i < pos.length; i++) {
                        addMarker(pos[i][0], pos[i][1], pos[i][2]);
                    }

                }, function () {
                    handleNoGeolocation(true);
                });
            } else {
                // Browser doesn't support Geolocation
                handleNoGeolocation(false);
            }

            // Create the DIV to hold the control and call the HomeControl() constructor
            // passing in this DIV.
            var homeControlDiv = document.createElement('DIV');
            var homeControl = new HomeControl(homeControlDiv, map);

            homeControlDiv.index = 1;
            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(homeControlDiv);
        });
    </script>
@*}*@